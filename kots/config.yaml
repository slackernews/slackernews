apiVersion: kots.io/v1beta1
kind: Config
metadata:
  name: slackernews-config
spec:
  groups:
    - name: slackernews
      title: General
      items:
        - name: slackernews_domain
          title: Domain Name
          type: text
          required: true
          validation:
            regex: 
              pattern: ^(([a-zA-Z]{1})|([a-zA-Z]{1}[a-zA-Z]{1})|([a-zA-Z]{1}[0-9]{1})|([0-9]{1}[a-zA-Z]{1})|([a-zA-Z0-9][a-zA-Z0-9-_]{1,61}[a-zA-Z0-9]))\.([a-zA-Z]{2,6}|[a-zA-Z0-9-]{2,30}\.[a-zA-Z]{2,3})$
              message: Please enter a valid hostname
        - name: access_option
          type: select_one
          title: Expose with
          default: node_port
          help_text: |
            How should traffic get to the application? 
          items:
            - name: ingress
              title: Kubernetes Ingress
            - name: load_balancer
              title: Load Balancer Service
          when: repl{{ ne NodeCount 1 }}
    - name: slack
      title: Slack App
      items:
        - name: slack_clientid
          title: Client ID
          description: the client secret was generated by Slack and serves as the username for Slackernews to connect to your workspace
          type: text
          required: true
        - name: slack_clientsecret
          title: Client Secret
          description: the client secret was generated by Slack and is effectively the password that Slackernews will use to connect
          type: password
          required: true
        - name: slack_bot_token
          title: Bot Token
          type: password
          description: the bot token is provided by Slack when you add Slackernews as a Slack application and starts with `xoxb`
          required: true
          validation:
            regex: 
              pattern: ^xoxb-.*$
              message: Please enter the Slack bot token for your instance of Slackernews
        - name: slack_user_token
          title: User Token
          type: password
          required: true
          description: the user token is provided by Slack when you add Slackernews as a Slack application and starts with `xoxp`
          validation:
            regex: 
              pattern: ^xoxp-.*$
              message: Please enter the Slack user token for your instance of Slackernews
    - name: postgres
      title: Postgresql
      items:
        - name: deploy_postgres
          type: bool
          title: Deploy Postgresql In Cluster
          default: "1"
        - name: postgres_password
          type: password
          title: Postgresql Password
          required: true
          hidden: true
          when: repl{{ ConfigOptionEquals "deploy_postgres" "1"}}
          value: repl{{ RandomString 40}}
        - name: postgres_external_uri
          type: text
          title: Postgresql URI
          required: true
          when: repl{{ ConfigOptionEquals "deploy_postgres" "0"}}
    - name: tls
      title: TLS
      items:
        - name: certificate_source
          type: select_one
          title: Certificate Source
          default: generate_internal
          items:
            - name: generate_internal
              title: Generate
            - name: upload_existing
              title: Upload
        - name: tls_cert
          title: Certificate
          type: file
          when: '{{repl ConfigOptionEquals "certificate_source" "upload_existing"}}'
        - name: tls_key
          title: Private Key
          type: file
          when: '{{repl ConfigOptionEquals "certificate_source" "upload_existing"}}'
        - name: tls_ca
          title: Signing Authority
          type: file
          when: '{{repl ConfigOptionEquals "certificate_source" "upload_existing"}}'

